services:
    frontend:
        build: ./tiqet-frontend
        depends_on:
            - backend
        ports:
            - 3000:3000
        environment:
            - BACKEND_URL=http://backend:8080
            - NEXT_PUBLIC_API_RETRY_INTERVAL_IN_SECONDS=5
            - NEXT_PUBLIC_API_MAX_RETRY=5
            - NEXTAUTH_URL=http://localhost:3000
            - NEXTAUTH_SECRET=ILoveTiqet!
            - TIQET_JWT_SECRET=ILoveTiqet!

    backend:
        build: ./tiqet-backend
        depends_on:
            db:
                condition: service_healthy
        environment:
            - POSTGRES_HOST=db
            - POSTGRES_PORT=5432
            - POSTGRES_USER=tiqet
            - POSTGRES_PASSWORD=ILoveTiqet!
            - POSTGRES_DB_NAME=tiqet

    db:
        image: postgres
        restart: unless-stopped
        environment:
            - POSTGRES_DB=tiqet
            - POSTGRES_USER=tiqet
            - POSTGRES_PASSWORD=ILoveTiqet!
        healthcheck:
            test: ["CMD-SHELL", "pg_isready -U tiqet -d tiqet"]
            interval: 5s
            timeout: 5s
            retries: 20
        volumes:
            - ./postgres-data:/var/lib/postgresql/data